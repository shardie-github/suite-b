<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Suite B — Reports</title>
<link rel="manifest" href="/manifest.webmanifest">
<style>
root{--bg#0b1220;--card#0f182b;--fg#e9eefb;--acc#5b8cff;--b#1a2642}
*{box-sizingborder-box}body{margin0;backgroundvar(--bg);colorvar(--fg);font-familysystem-ui}
.wrap{max-width1100px;margin0 auto;padding24px}
h1{margin0 0 12px} .bar{displayflex;gap8px;flex-wrapwrap}
input,button,a.badge,select{padding10px;border-radius10px;border1px solid var(--b);background#0f182b;color#e9eefb}
button{backgroundvar(--acc);bordernone;cursorpointer}
.card{backgroundvar(--card);border1px solid var(--b);border-radius12px;padding16px;margin-top16px}
table{width100%;border-collapsecollapse}th,td{border-bottom1px solid var(--b);padding10px;text-alignleft}
a.badge{text-decorationnone;displayinline-block}
.drop{border2px dashed var(--b); border-radius12px; padding12px; text-aligncenter; margin-top10px}
@media(max-width640px){.bar{flex-directioncolumn}}
</style></head>
<body>
<div class="wrap" role="main" aria-label="Reports">
  <h1>Suite B — Reports</h1>
  <div class="bar" role="region" aria-label="Filters">
    <label>Tenant <input id="tenant" ="default"></label>
    <label>API key <input id="key" ="paste key"></label>
    <label>From <input id="from" type="date"></label>
    <label>To <input id="to" type="date"></label>
    <label>Sort
      <select id="sort">
        <option value="datedesc">datedesc</option>
        <option value="dateasc">dateasc</option>
        <option value="idasc">idasc</option>
        <option value="iddesc">iddesc</option>
      </select>
    </label>
    <label>Page <input id="page" type="number" value="1" min="1" style="width90px"></label>
    <label>Size <input id="size" type="number" value="50" min="1" max="500" style="width90px"></label>
    <button id="go">Run</button>
    <a id="csv" class="badge" href="#" target="_blank">CSV</a>
    <a class="badge" href="/admin" aria-label="Admin">Admin</a>
  </div>
  <div class="drop" id="drop">Drop CSV here to import (id,date,type,status,email)</div>
  <div class="card" aria-live="polite">
    <table><thead><tr><th>ID</th><th>Date</th><th>Type</th><th>Status</th><th>Email</th></tr></thead><tbody id="rows"><tr><td colspan="5">Loading…</td></tr></tbody></table>
    <div id="meta" style="margin-top8px;font-size12px;opacity.8"></div>
  </div>
</div>
<script>
async function run(){
  const t = gv('tenant','default'), k = gv('key',''), f = gv('from','2025-01-01'), to = gv('to','2025-12-31');
  const page=gv('page','1'), size=gv('size','50'), sort=gv('sort','datedesc');
  const headers = k? {'x-api-key'k,'x-tenant-id't}  {};
  const r = await fetch(`/api/reports?from=${f}&to=${to}&page=${page}&size=${size}&sort=${sort}`, {headers});
  const j = await r.json().catch(()=>({rows[]}));
  document.getElementById('rows').innerHTML = (j.rows||[]).map(x=>`<tr><td>${x.id}</td><td>${x.date}</td><td>${x.type}</td><td>${x.status}</td><td>${x.email||""}</td></tr>`).join('') || '<tr><td colspan="5">No rows.</td></tr>';
  document.getElementById('csv').href = `/api/reports.csv?from=${f}&to=${to}`;
  document.getElementById('meta').textContent = `total=${j.total||0} page=${j.page||1} size=${j.size||50} usage=${(j.usage&&j.usage["report.query"])||0}`;
}
function gv(id,def){ const el=document.getElementById(id); return (el?.value||def); }
document.getElementById('go').onclick = run; run();

// CSV drop
const drop=document.getElementById('drop');
drop.addEventListener('dragover',e=>{e.preventDefault(); drop.style.opacity=.7;});
drop.addEventListener('dragleave',e=>{drop.style.opacity=1;});
drop.addEventListener('drop',async e=>{
  e.preventDefault(); drop.style.opacity=1;
  const f=e.dataTransfer.files[0]; if(!f) return;
  const text=await f.text();
  const t=gv('tenant','default'), k=gv('key','');
  const res=await fetch('/api/import/csv',{method'POST', headers{'content-type''text/csv','x-tenant-id't,'x-api-key'k}, bodytext});
  const j=await res.json(); alert('Imported '+(j.added||0)); run();
});

// PWA
navigator.serviceWorker?.register('/sw.js').catch(()=>{});
</script>
<div style="padding12px"><a href="/dashboard.html">Dashboard</a> · <a href="/roi.html">ROI</a> · <a href="/admin">Admin</a></div></body></html>
